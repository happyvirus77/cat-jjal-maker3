<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>고양이 가라사대</title>
    <style>
      body { text-align: center; }
      .main-card button { position: relative; left: -45px; bottom: 15px; }
      .favorites { list-style: none; display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; }
      .favorites img { width: 150px; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <script type="text/babel">
      function CatItem({ img }){
        return(
          <li>
            <img src={img} alt="고양이" style={{width: "150px"}}/>
          </li>
        )
      }

      function Favorites({ favorites = [] }){
        return(
          <ul className="favorites">
            {favorites.map(cat => <CatItem img={cat} key={cat}/>)}
          </ul>
        )
      }

      const MainCard=({ img, onHeartClick })=>(
        <div className="main-card">
          <img src={img} alt="고양이" width="400" />
          <button onClick={onHeartClick}>🤍</button>
        </div>
      )

      const Title=({ children })=> <h1>{children}</h1>;

      const Form=({ updateMainCat })=>{
        const [value, setValue] = React.useState('');
        const [errorMessage, setErrorMessage] = React.useState('');

        const includesHangul = (text) => /[ㄱ-ㅎㅏ-ㅣ가-힣]/.test(text);

        function handleInputChange(e){
          const userValue = e.target.value;
          if (includesHangul(userValue)) {
            setErrorMessage('한글은 입력할 수 없습니다.');
          } else {
            setErrorMessage(''); // 한글이 아니면 에러 해제
          }
          setValue(userValue.toUpperCase());
        }

        function handleFormSubmit(e){
          e.preventDefault();
          if (value.trim() === '') {
            setErrorMessage('빈 값으로 만들 수 없습니다.');
            return;
          }
          updateMainCat(); // 유효하면 부모 콜백 호출
        }

        return(
          <form onSubmit={handleFormSubmit}>
            <input
              type="text"
              name="name"
              placeholder="영어 대사를 입력해주세요"
              value={value}
              onChange={handleInputChange}
            />
            <button type="submit">생성</button>
            <p style={{color: 'red', minHeight: '1em'}}>{errorMessage}</p>
          </form>
        )
      }

      const App=()=>{
        const CAT1="https://cataas.com/cat/HSENVDU4ZMqy7KQ0/says/react";
        const CAT2="https://cataas.com/cat/BxqL2EjFmtxDkAm2/says/inflearn";
        const CAT3="https://cataas.com/cat/18MD6byVC1yKGpXp/says/JavaScript";

        const [counter, setCounter]=React.useState(
          Number(localStorage.getItem('counter'))
        );
        const [mainCat, setMainCat]=React.useState(CAT1);
        const [favorites, setFavorites]=React.useState([CAT1, CAT2, CAT3]);

        // 부모 콜백은 이벤트를 받지 않습니다(이벤트 취소는 Form에서 처리)
        const updateMainCat=()=>{
          const nextCounter=counter+1;
          setCounter(nextCounter);
          setMainCat(CAT2);

          localStorage.setItem('counter',nextCounter)
        }

        const handleHeartClick=()=>{
          const nextFavorites=[...favorites, mainCat];
          setFavorites(nextFavorites);
          jsonLocalStorage.setItem("favorites",nextFaovrites)
        }

        return (
          <div>
            <Title>{counter}번째 고양이 가라사대</Title>
            <Form updateMainCat={updateMainCat}/>
            <MainCard img={mainCat} onHeartClick={handleHeartClick}/>
            <Favorites favorites={favorites}/>
          </div>
        )
      }

      const root=ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App/>);
    </script>
  </body>
</html>
